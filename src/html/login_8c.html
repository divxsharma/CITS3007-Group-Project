<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: login.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">login.c File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Handles user authentication, session management, and account status checks.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;unistd.h&gt;</code><br />
<code>#include &lt;stdbool.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &quot;login.h&quot;</code><br />
<code>#include &quot;<a class="el" href="logging_8h_source.html">logging.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="db_8h_source.html">db.h</a>&quot;</code><br />
<code>#include &quot;banned.h&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for login.c:</div>
<div class="dyncontent">
<div class="center"><img src="login_8c__incl.png" border="0" usemap="#alogin_8c" alt=""/></div>
<map name="alogin_8c" id="alogin_8c">
<area shape="rect" title="Handles user authentication, session management, and account status checks." alt="" coords="297,5,362,32"/>
<area shape="rect" title=" " alt="" coords="5,80,80,107"/>
<area shape="rect" title=" " alt="" coords="127,229,209,256"/>
<area shape="rect" title=" " alt="" coords="494,80,565,107"/>
<area shape="rect" href="login_8h_source.html" title=" " alt="" coords="296,80,363,107"/>
<area shape="rect" href="logging_8h.html" title="API for the logging system." alt="" coords="387,80,469,107"/>
<area shape="rect" href="db_8h.html" title="API for the database system." alt="" coords="221,80,272,107"/>
<area shape="rect" href="banned_8h_source.html" title=" " alt="" coords="589,80,672,107"/>
<area shape="rect" href="account_8h_source.html" title=" " alt="" coords="205,155,291,181"/>
<area shape="rect" title=" " alt="" coords="242,229,313,256"/>
<area shape="rect" title=" " alt="" coords="341,229,405,256"/>
<area shape="rect" title=" " alt="" coords="416,155,483,181"/>
<area shape="rect" title=" " alt="" coords="507,155,581,181"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:abf3b37509991b6601c578b8af8cbbacd"><td class="memItemLeft" align="right" valign="top">login_result_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="login_8c.html#abf3b37509991b6601c578b8af8cbbacd">handle_login</a> (const char *userid, const char *password, ip4_addr_t client_ip, time_t login_time, int client_output_fd, int log_fd, <a class="el" href="structlogin__session__data__t.html">login_session_data_t</a> *session)</td></tr>
<tr class="memdesc:abf3b37509991b6601c578b8af8cbbacd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles user login by verifying credentials, account status, and updating session data.  <a href="login_8c.html#abf3b37509991b6601c578b8af8cbbacd">More...</a><br /></td></tr>
<tr class="separator:abf3b37509991b6601c578b8af8cbbacd"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >Handles user authentication, session management, and account status checks. </p>
<p >This file implements the login procedure for validating user credentials, managing session and enforcing account restrictions like as bans, expiration and login failure. It interacts with the account functions for validation and logs for debug and info purposes.</p>
<p >Functions in this file ensure that only valid, non-banned, non-expired users with correct credentials are allowed to initiate a session. It securely populates login session metadata and sends status messages to clients.</p>
<dl class="section author"><dt>Author</dt><dd>Div Sharma [23810783] </dd>
<dd>
Pranav Rajput [23736075] </dd>
<dd>
William Lo [23722943] </dd>
<dd>
Zachary Wang [24648002] </dd>
<dd>
Jun Hao Dennis Lou [23067779]</dd></dl>
<dl class="bug"><dt><b><a class="el" href="bug.html#_bug000002">Bug:</a></b></dt><dd>No known bugs. </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="abf3b37509991b6601c578b8af8cbbacd" name="abf3b37509991b6601c578b8af8cbbacd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abf3b37509991b6601c578b8af8cbbacd">&#9670;&nbsp;</a></span>handle_login()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">login_result_t handle_login </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>userid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>password</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ip4_addr_t&#160;</td>
          <td class="paramname"><em>client_ip</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>login_time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>client_output_fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>log_fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structlogin__session__data__t.html">login_session_data_t</a> *&#160;</td>
          <td class="paramname"><em>session</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handles user login by verifying credentials, account status, and updating session data. </p>
<p >This function does the following:</p><ul>
<li>Validating the <code>userid</code> and <code>password</code> inputs.</li>
<li>Looking up the account by <code>userid</code>.</li>
<li>Checking if the account is banned or expired.</li>
<li>Checking for too many failed login attempts.</li>
<li>Verifying the password using secure comparison.</li>
<li>Updating the session data with account ID and session times.</li>
<li>Logging the result of the login attempt.</li>
<li>Sending a success or failure message to the client.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">userid</td><td>A pointer to user identifier string. </td></tr>
    <tr><td class="paramname">password</td><td>A pointer to plaintext password string. </td></tr>
    <tr><td class="paramname">client_ip</td><td>The IPv4 address of the connecting client. </td></tr>
    <tr><td class="paramname">login_time</td><td>The server time at which login was attempted. </td></tr>
    <tr><td class="paramname">client_output_fd</td><td>File descriptor used to send the login result to the client. </td></tr>
    <tr><td class="paramname">log_fd</td><td>File descriptor reserved for future logging or audit output. </td></tr>
    <tr><td class="paramname">session</td><td>A pointer to <code><a class="el" href="structlogin__session__data__t.html">login_session_data_t</a></code> structure to show on successful login.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section pre"><dt>Precondition</dt><dd><code>userid</code>, <code>password</code>, and <code>session</code> must not be NULL. </dd>
<dd>
<code>client_output_fd</code> must be a valid writable file descriptor.</dd></dl>
<dl class="section post"><dt>Postcondition</dt><dd>On success, session details are filled and a message is sent to the client. On failure, an appropriate <code>LOGIN_FAIL_*</code> result is returned.</dd></dl>
<dl class="section return"><dt>Returns</dt><dd><code>LOGIN_SUCCESS</code> on successful authentication; otherwise, a <code>login_result_t</code> displays reason for failure:<ul>
<li><code>LOGIN_FAIL_USER_NOT_FOUND</code></li>
<li><code>LOGIN_FAIL_BAD_PASSWORD</code></li>
<li><code>LOGIN_FAIL_ACCOUNT_BANNED</code></li>
<li><code>LOGIN_FAIL_ACCOUNT_EXPIRED</code> </li>
</ul>
</dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4
</small></address>
</body>
</html>
