\hypertarget{account_8h_source}{}\doxysection{account.\+h}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{// DO NOT SUBMIT THIS FILE}}
\DoxyCodeLine{2 \textcolor{comment}{//}}
\DoxyCodeLine{3 \textcolor{comment}{// When submitting your project, this file will be overwritten}}
\DoxyCodeLine{4 \textcolor{comment}{// by the automated build and test system.}}
\DoxyCodeLine{5 \textcolor{comment}{//}}
\DoxyCodeLine{6 \textcolor{comment}{// DO NOT EDIT THIS FILE}}
\DoxyCodeLine{7 \textcolor{comment}{//}}
\DoxyCodeLine{8 \textcolor{comment}{// Since any changes you make will be lost when you submit your project.}}
\DoxyCodeLine{9 }
\DoxyCodeLine{10 \textcolor{preprocessor}{\#ifndef ACCOUNT\_H}}
\DoxyCodeLine{11 \textcolor{preprocessor}{\#define ACCOUNT\_H}}
\DoxyCodeLine{12 }
\DoxyCodeLine{13 \textcolor{preprocessor}{\#include <stdint.h>}}
\DoxyCodeLine{14 \textcolor{preprocessor}{\#include <stdbool.h>}}
\DoxyCodeLine{15 \textcolor{preprocessor}{\#include <time.h>}}
\DoxyCodeLine{16 }
\DoxyCodeLine{17 \textcolor{preprocessor}{\#define USER\_ID\_LENGTH 100}}
\DoxyCodeLine{18 \textcolor{preprocessor}{\#define HASH\_LENGTH 128}}
\DoxyCodeLine{19 \textcolor{preprocessor}{\#define EMAIL\_LENGTH 100}}
\DoxyCodeLine{20 \textcolor{preprocessor}{\#define BIRTHDATE\_LENGTH 10}}
\DoxyCodeLine{21 \textcolor{preprocessor}{\#define IP\_SIZE 4}}
\DoxyCodeLine{22 }
\DoxyCodeLine{26 \textcolor{keyword}{typedef} uint32\_t ip4\_addr\_t;}
\DoxyCodeLine{27 }
\DoxyCodeLine{31 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\{}
\DoxyCodeLine{32   int64\_t account\_id;}
\DoxyCodeLine{33   \textcolor{keywordtype}{char} userid[USER\_ID\_LENGTH];      \textcolor{comment}{// User ID of up to USER\_ID\_LENGTH chars; null-\/terminated if less than that}}
\DoxyCodeLine{34   \textcolor{keywordtype}{char} password\_hash[HASH\_LENGTH];  \textcolor{comment}{// Encodes details of a hashed password (e.g. hash algorithm, salt, actual hash,}}
\DoxyCodeLine{35                                     \textcolor{comment}{// etc.).}}
\DoxyCodeLine{36                                     \textcolor{comment}{// Is always null terminated and is of length < HASH\_LENGTH.}}
\DoxyCodeLine{37   \textcolor{keywordtype}{char} email[EMAIL\_LENGTH];         \textcolor{comment}{// An email address of up to EMAIL\_LENGTH chars; null-\/terminated if less than that}}
\DoxyCodeLine{38   time\_t unban\_time;                \textcolor{comment}{// Ban the account up until this time (0 = no ban)}}
\DoxyCodeLine{39   time\_t expiration\_time;           \textcolor{comment}{// Account is only valid until this time (0 = unlimited)}}
\DoxyCodeLine{40   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} login\_count;         \textcolor{comment}{// Number of successful auth attempts, default = 0}}
\DoxyCodeLine{41   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} login\_fail\_count;    \textcolor{comment}{// Number of unsuccessful auth attempts, default = 0}}
\DoxyCodeLine{42   time\_t last\_login\_time;           \textcolor{comment}{// Time of last successful login, default = time 0.}}
\DoxyCodeLine{43   ip4\_addr\_t last\_ip;               \textcolor{comment}{// Last IP connected from, default = 0}}
\DoxyCodeLine{44   \textcolor{keywordtype}{char} birthdate[BIRTHDATE\_LENGTH]; \textcolor{comment}{// Birth date (format: YYYY-\/MM-\/DD, default: 0000-\/00-\/00)}}
\DoxyCodeLine{45 \} \mbox{\hyperlink{structaccount__t}{account\_t}};}
\DoxyCodeLine{46 }
\DoxyCodeLine{47 }
\DoxyCodeLine{48 }
\DoxyCodeLine{50 \textcolor{comment}{// Account creation}}
\DoxyCodeLine{51 }
\DoxyCodeLine{52 \textcolor{comment}{// create an account with specified userid, hash derived from}}
\DoxyCodeLine{53 \textcolor{comment}{// specifed password, specified email, and specified birthdate.}}
\DoxyCodeLine{54 \textcolor{comment}{// Other fields are set to their default values.}}
\DoxyCodeLine{55 \textcolor{comment}{// returns null on error and logs an error message.}}
\DoxyCodeLine{56 \mbox{\hyperlink{structaccount__t}{account\_t}} *\mbox{\hyperlink{account_8c_ab4b3c46b66720750719df193c4201b15}{account\_create}}(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *userid,}
\DoxyCodeLine{57                           \textcolor{keyword}{const} \textcolor{keywordtype}{char} *plaintext\_password,}
\DoxyCodeLine{58                           \textcolor{keyword}{const} \textcolor{keywordtype}{char} *email,}
\DoxyCodeLine{59                           \textcolor{keyword}{const} \textcolor{keywordtype}{char} *birthdate);}
\DoxyCodeLine{60 }
\DoxyCodeLine{61 \textcolor{comment}{// free memory and resources used by the account}}
\DoxyCodeLine{62 \textcolor{keywordtype}{void} \mbox{\hyperlink{account_8c_af686b29dd44e962dd68627d051e96a65}{account\_free}}(\mbox{\hyperlink{structaccount__t}{account\_t}} *acc);}
\DoxyCodeLine{63 }
\DoxyCodeLine{65 \textcolor{comment}{// Password handling}}
\DoxyCodeLine{66 }
\DoxyCodeLine{67 \textcolor{comment}{// check whether supplied password is correct. returns true on success, false on failure}}
\DoxyCodeLine{68 \textcolor{comment}{// plaintext\_password is the password to check, and should be transmitted over a secure channel.}}
\DoxyCodeLine{69 \textcolor{comment}{// acc is the account to check against.}}
\DoxyCodeLine{70 \textcolor{keywordtype}{bool} \mbox{\hyperlink{account_8c_a0051b990f5e6a9e4800ed05a7c72fb4d}{account\_validate\_password}}(\textcolor{keyword}{const} \mbox{\hyperlink{structaccount__t}{account\_t}} *acc, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *plaintext\_password);}
\DoxyCodeLine{71 }
\DoxyCodeLine{72 \textcolor{comment}{// set hashed password record derived from new plaintext password.}}
\DoxyCodeLine{73 \textcolor{comment}{// returns true on success, false on failure}}
\DoxyCodeLine{74 \textcolor{keywordtype}{bool} \mbox{\hyperlink{account_8c_aa4ca3ecc137d919f74b096b4c9c69e06}{account\_update\_password}}(\mbox{\hyperlink{structaccount__t}{account\_t}} *acc, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *new\_plaintext\_password);}
\DoxyCodeLine{75 }
\DoxyCodeLine{77 \textcolor{comment}{// Login tracking}}
\DoxyCodeLine{78 }
\DoxyCodeLine{79 \textcolor{comment}{// record a successful login. ip must be a valid IPv4 address.}}
\DoxyCodeLine{80 \textcolor{keywordtype}{void} \mbox{\hyperlink{account_8c_a2c3dd2f57c748c5d4502017deedcd1db}{account\_record\_login\_success}}(\mbox{\hyperlink{structaccount__t}{account\_t}} *acc, ip4\_addr\_t ip);}
\DoxyCodeLine{81 }
\DoxyCodeLine{82 \textcolor{comment}{// record a failed login}}
\DoxyCodeLine{83 \textcolor{keywordtype}{void} \mbox{\hyperlink{account_8c_aa08ce919568178b2a576aa6cf4c26930}{account\_record\_login\_failure}}(\mbox{\hyperlink{structaccount__t}{account\_t}} *acc);}
\DoxyCodeLine{84 }
\DoxyCodeLine{86 \textcolor{comment}{// Account state checks}}
\DoxyCodeLine{87 }
\DoxyCodeLine{88 \textcolor{comment}{// whether account is banned}}
\DoxyCodeLine{89 \textcolor{keywordtype}{bool} \mbox{\hyperlink{account_8c_af9c70fb0d71e6d3a8281fe6d456c0bf0}{account\_is\_banned}}(\textcolor{keyword}{const} \mbox{\hyperlink{structaccount__t}{account\_t}} *acc);}
\DoxyCodeLine{90 }
\DoxyCodeLine{91 \textcolor{comment}{// whether account is expired}}
\DoxyCodeLine{92 \textcolor{keywordtype}{bool} \mbox{\hyperlink{account_8c_a34a441e59238b76a8cd7f36c94a1ae1b}{account\_is\_expired}}(\textcolor{keyword}{const} \mbox{\hyperlink{structaccount__t}{account\_t}} *acc);}
\DoxyCodeLine{93 }
\DoxyCodeLine{95 \textcolor{comment}{// Metadata updates}}
\DoxyCodeLine{96 }
\DoxyCodeLine{97 \textcolor{comment}{// set a ban and an expire time. }}
\DoxyCodeLine{98 \textcolor{keywordtype}{void} \mbox{\hyperlink{account_8c_aada84f2a8333027836a619f14c554ba2}{account\_set\_unban\_time}}(\mbox{\hyperlink{structaccount__t}{account\_t}} *acc, time\_t t);}
\DoxyCodeLine{99 }
\DoxyCodeLine{100 \textcolor{comment}{// set an account expiration time}}
\DoxyCodeLine{101 \textcolor{keywordtype}{void} \mbox{\hyperlink{account_8c_a10db748111392ca7df1d47f35a5e8b21}{account\_set\_expiration\_time}}(\mbox{\hyperlink{structaccount__t}{account\_t}} *acc, time\_t t);}
\DoxyCodeLine{102 }
\DoxyCodeLine{103 \textcolor{comment}{// set account email address}}
\DoxyCodeLine{104 \textcolor{keywordtype}{void} \mbox{\hyperlink{account_8c_a5da35963ec07426278f66f9d37db58cb}{account\_set\_email}}(\mbox{\hyperlink{structaccount__t}{account\_t}} *acc, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *new\_email);}
\DoxyCodeLine{105 }
\DoxyCodeLine{106 \textcolor{comment}{// print account information to the specified file descriptor}}
\DoxyCodeLine{107 \textcolor{comment}{// (e.g. stdout, stderr, or a log file).}}
\DoxyCodeLine{108 \textcolor{comment}{// The account information is printed in a human-\/readable format.}}
\DoxyCodeLine{109 \textcolor{comment}{// returns true on success, false on failure.}}
\DoxyCodeLine{110 \textcolor{comment}{// The caller is responsible for ensuring that the file descriptor is valid and writable.}}
\DoxyCodeLine{111 \textcolor{keywordtype}{bool} \mbox{\hyperlink{account_8c_a0d1dafdb93c9614ad833f3f940263d28}{account\_print\_summary}}(\textcolor{keyword}{const} \mbox{\hyperlink{structaccount__t}{account\_t}} *acct, \textcolor{keywordtype}{int} fd);}
\DoxyCodeLine{112 }
\DoxyCodeLine{113 }
\DoxyCodeLine{114 }
\DoxyCodeLine{115 \textcolor{preprocessor}{\#endif }\textcolor{comment}{// ACCOUNT\_H}}

\end{DoxyCode}
